<phone:PhoneApplicationPage
                            xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                            xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                            xmlns:phone="clr-namespace:Microsoft.Phone.Controls;assembly=Microsoft.Phone"
                            xmlns:shell="clr-namespace:Microsoft.Phone.Shell;assembly=Microsoft.Phone"
                            xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                            xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                            xmlns:Controls="clr-namespace:Vine.Controls" xmlns:toolkit="clr-namespace:Microsoft.Phone.Controls;assembly=Microsoft.Phone.Controls.Toolkit"
                            xmlns:local="clr-namespace:Vine.Pages.Search" x:Class="Vine.Pages.Search.SearchPage"
                            SupportedOrientations="Portrait" Orientation="Portrait"
                            mc:Ignorable="d" shell:SystemTray.IsVisible="True" shell:SystemTray.Opacity="0"
                            shell:SystemTray.ForegroundColor="#FF808080">
    <toolkit:TransitionService.NavigationInTransition>
        <toolkit:NavigationInTransition>

            <toolkit:NavigationInTransition.Forward>
                <toolkit:TurnstileTransition Mode="ForwardIn" />
            </toolkit:NavigationInTransition.Forward>
        </toolkit:NavigationInTransition>
    </toolkit:TransitionService.NavigationInTransition>
    <toolkit:TransitionService.NavigationOutTransition>
        <toolkit:NavigationOutTransition>

            <toolkit:NavigationOutTransition.Backward>
                <toolkit:TurnstileTransition Mode="BackwardOut" />
            </toolkit:NavigationOutTransition.Backward>
        </toolkit:NavigationOutTransition>
    </toolkit:TransitionService.NavigationOutTransition>

    <phone:PhoneApplicationPage.Resources>


        <Style x:Key="SearchResultDescriptionStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="18" />
            <Setter Property="FontFamily" Value="Segoe WP Light"/>
            <Setter Property="Margin" Value="0,-4,0,0"/>
            <Setter Property="Foreground" Value="{StaticResource DarkGreyBrush}"/>
        </Style>


        <local:NbrPostConverter x:Key="NbrPostConverter"/>
        <DataTemplate x:Key="PivotHeaderDataTemplate">
            <TextBlock Text="{Binding }" FontFamily="Segoe WP Light" Margin="0" FontSize="50" />
        </DataTemplate>




        <DataTemplate x:Key="VineTag">
            <StackPanel Margin="12,12,0,0">
                <TextBlock FontSize="32" Foreground="{StaticResource ThemeTextBrush}">
                    						<Run Text="#" FontFamily="Segoe WP Bold" Foreground="{StaticResource PrincBrush}" /><Run Text="{Binding Tag}" FontFamily="Segoe WP SemiLight" />
                </TextBlock>
                <TextBlock Text="{Binding Count, Converter={StaticResource NbrPostConverter}}" 
                               Style="{StaticResource SearchResultDescriptionStyle}"/>
            </StackPanel>
        </DataTemplate>



        <DataTemplate x:Key="VineUserDataTemplate">
            <Grid Margin="0,12,0,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="auto" />
                </Grid.ColumnDefinitions>
                <Button Style="{StaticResource SimpleButtonStyle}" Click="ViewProfile_Click">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <Image Source="{Binding Picture}" VerticalAlignment="Top" Height="60"
												Width="60" Stretch="UniformToFill" Margin="12,0,12,0">
                            <Image.Clip>
                                <EllipseGeometry Center="30,30" RadiusX="30" RadiusY="30"/>
                            </Image.Clip>
                        </Image>
                        <StackPanel Grid.Column="1">
                            <TextBlock Text="{Binding Name}" Foreground="{StaticResource ThemeTextBrush}" FontSize="22" FontFamily="Segoe WP Semibold" />
                            <TextBlock Text="{Binding SubName}" Style="{StaticResource SearchResultDescriptionStyle}" />
                        </StackPanel>
                    </Grid>
                </Button>

                <ToggleButton Click="Following_Click" IsChecked="{Binding Following}" VerticalAlignment="Top"
										Grid.Column="1" Style="{StaticResource FollowToggleButtonStyle}" />
            </Grid>
        </DataTemplate>
    </phone:PhoneApplicationPage.Resources>
    <phone:PhoneApplicationPage.FontFamily>
        <StaticResource ResourceKey="PhoneFontFamilyNormal"/>
    </phone:PhoneApplicationPage.FontFamily>
    <phone:PhoneApplicationPage.FontSize>
        <StaticResource ResourceKey="PhoneFontSizeNormal"/>
    </phone:PhoneApplicationPage.FontSize>
    <phone:PhoneApplicationPage.Foreground>
        <StaticResource ResourceKey="PhoneForegroundBrush"/>
    </phone:PhoneApplicationPage.Foreground>
    <!--LayoutRoot is the root grid where all page content is placed-->
    <Grid x:Name="LayoutRoot" Background="{StaticResource NoStripeBrush}">
        <VisualStateManager.VisualStateGroups>
            <VisualStateGroup x:Name="VisualStateGroup">
                <VisualStateGroup.Transitions>
                    <VisualTransition GeneratedDuration="0:0:0.4">
                        <VisualTransition.GeneratedEasingFunction>
                            <CircleEase EasingMode="EaseOut"/>
                        </VisualTransition.GeneratedEasingFunction>
                    </VisualTransition>
                </VisualStateGroup.Transitions>
                <VisualState x:Name="DirectSearch">
                    <Storyboard>
                        <DoubleAnimation Duration="0" To="800" Storyboard.TargetProperty="(UIElement.RenderTransform).(CompositeTransform.TranslateX)" Storyboard.TargetName="PopularPanel" d:IsOptimized="True"/>
                    </Storyboard>
                </VisualState>
                <VisualState x:Name="Popular">
                    <Storyboard>
                        <DoubleAnimation Duration="0" To="-64" Storyboard.TargetProperty="(UIElement.RenderTransform).(CompositeTransform.TranslateY)" Storyboard.TargetName="WhitePanel" d:IsOptimized="True"/>
                        <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="(UIElement.Visibility)" Storyboard.TargetName="PopularPanel">
                            <DiscreteObjectKeyFrame KeyTime="0">
                                <DiscreteObjectKeyFrame.Value>
                                    <Visibility>Visible</Visibility>
                                </DiscreteObjectKeyFrame.Value>
                            </DiscreteObjectKeyFrame>
                        </ObjectAnimationUsingKeyFrames>
                        <DoubleAnimation Duration="0" To="-480" Storyboard.TargetProperty="(UIElement.RenderTransform).(CompositeTransform.TranslateX)" Storyboard.TargetName="ResultPivot" d:IsOptimized="True"/>
                    </Storyboard>
                </VisualState>
            </VisualStateGroup>
        </VisualStateManager.VisualStateGroups>
        <Grid.RowDefinitions>
            <RowDefinition Height="80" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <StackPanel x:Name="WhitePanel" Grid.RowSpan="3" RenderTransformOrigin="0.5,0.5" >
            <StackPanel.RenderTransform>
                <CompositeTransform/>
            </StackPanel.RenderTransform>

            <Grid>
                <Rectangle Fill="{StaticResource ModernHeaderBrush}" Height="230" VerticalAlignment="Top"/>
                <Rectangle x:Name="ShadowRectangle" Visibility="Collapsed" Fill="{StaticResource ShadowBrush}" Height="4" VerticalAlignment="Bottom" />
                <ProgressBar Visibility="{Binding IsLoading, Converter={StaticResource VisibilityConverter}}" Background="{x:Null}" IsIndeterminate="True" VerticalAlignment="Bottom" Foreground="{StaticResource PrincBrush}" />
            </Grid>
        </StackPanel>
        <Grid Grid.Row="0" Height="80" Margin="0">
            <Grid Margin="24,24,0,0">
                <ContentControl HorizontalAlignment="Left" Height="25"  Style="{StaticResource LogoStyle}" Width="32"/>
                <TextBlock Text="{Binding LocalizedResources.TitleSearch, Source={StaticResource LocalizedStrings}}"
					FontFamily="Segoe WP Semibold" FontSize="26.667" Margin="40,0,0,0" Foreground="{StaticResource ModernForegroundBrush}" VerticalAlignment="Center"
					HorizontalAlignment="Left" />
            </Grid>
        </Grid>


        <Grid Grid.Row="1" >
            <TextBlock Text="{Binding LocalizedResources.EnterYourSearch, Source={StaticResource LocalizedStrings}}"
				Visibility="{Binding Text, ConverterParameter=inverse, Converter={StaticResource StringToVisibilityConverter}, ElementName=SearchBox}"
				FontFamily="Segoe WP SemiLight" VerticalAlignment="Center" FontSize="26.667" Margin="36,0,0,0" Foreground="{StaticResource GreyBrush}" />
            <TextBox x:Name="SearchBox"  FontFamily="Segoe WP SemiLight"  Margin="12,0" Background="Transparent"
				BorderBrush="{StaticResource GreyBrush}" Padding="12,2,2,2" Foreground="{StaticResource ModernForegroundBrush}" SelectionBackground="{StaticResource PrincBrush}"
				GotFocus="SearchBox_GotFocus" LostFocus="SearchBox_LostFocus"  />
        </Grid>
        <Grid x:Name="ContentPanel" Grid.Row="2">
            <phone:Pivot  x:Name="ResultPivot" SelectionChanged="Pivot_SelectionChanged"
				HeaderTemplate="{StaticResource PivotHeaderDataTemplate}" Margin="0,-14,0,0" Foreground="{StaticResource ModernForegroundBrush}">
                <phone:Pivot.RenderTransform>
                    <CompositeTransform />
                </phone:Pivot.RenderTransform>
                <phone:PivotItem Header="{Binding LocalizedResources.Users, Source={StaticResource LocalizedStrings}}">
                    <phone:LongListSelector x:Name="ListUser" ItemRealized="ListUsers_ItemRealized"
						ItemsSource="{Binding ResultsUsers}" Margin="0,-6,0,0">

                    </phone:LongListSelector>

                </phone:PivotItem>
                <phone:PivotItem x:Name="PivotTag"  Header="{Binding LocalizedResources.Tags, Source={StaticResource LocalizedStrings}}">
                    <phone:LongListSelector x:Name="TagsList" ItemRealized="ListTags_ItemRealized"
                    		ItemsSource="{Binding ResultsTags}" Margin="0,-6,0,0" SelectionChanged="Tag_SelectionChanged">

                    </phone:LongListSelector>

                </phone:PivotItem>
            </phone:Pivot>
            <Grid x:Name="PopularPanel" Visibility="Collapsed" RenderTransformOrigin="0.5,0.5">
                <Grid.RenderTransform>
                    <CompositeTransform/>
                </Grid.RenderTransform>

                <ScrollViewer Margin="0,36,0,0">
                    <ItemsControl x:Name="ListPosts" ItemsSource="{Binding PopularPosts}" Margin="18,0,12,0">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <toolkit:WrapPanel />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Grid  Background="{StaticResource GreyBrush}" Margin="6">
                                    <Image Source="{Binding MinThumb}" Tap="Thumb_Tap" Height="136" Width="136"  />
                                    <Path IsHitTestVisible="False" Visibility="{Binding IsVideo, Converter={StaticResource VisibilityConverter}}" Data="{StaticResource LittleVideoPlayButton}" Fill="White" UseLayoutRounding="False" VerticalAlignment="Center" HorizontalAlignment="Center" Width="60" Height="60" Stretch="Uniform"/>
                                </Grid>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>

                    </ItemsControl>




                </ScrollViewer>

                <ProgressBar IsIndeterminate="{Binding LoadingPopular}"  VerticalAlignment="Center" Foreground="{StaticResource PrincBrush}" Background="Transparent"/>
            </Grid>


        </Grid>

    </Grid>

</phone:PhoneApplicationPage>