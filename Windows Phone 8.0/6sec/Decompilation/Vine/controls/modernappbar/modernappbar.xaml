<UserControl x:Class="Vine.Controls.ModernAppBar"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="clr-namespace:Vine.Controls"
    xmlns:toolkit="clr-namespace:Microsoft.Phone.Controls;assembly=Microsoft.Phone.Controls.Toolkit"
    mc:Ignorable="d"
             x:Name="RootControl"
            Background="{StaticResource PrincBrush}"
    FontFamily="{StaticResource PhoneFontFamilyNormal}"
    FontSize="{StaticResource PhoneFontSizeNormal}"
    Foreground="{StaticResource PhoneForegroundBrush}"
    d:DesignHeight="480" d:DesignWidth="480">
    <UserControl.Resources>

    </UserControl.Resources>

    <Grid x:Name="RootPanel">
        <VisualStateManager.VisualStateGroups>
            <VisualStateGroup x:Name="VisualStateGroup">
                <VisualStateGroup.Transitions>
                    <VisualTransition GeneratedDuration="0:0:0.3">
                        <VisualTransition.GeneratedEasingFunction>
                            <CircleEase EasingMode="EaseOut"/>
                        </VisualTransition.GeneratedEasingFunction>
                    </VisualTransition>
                </VisualStateGroup.Transitions>
                <VisualState x:Name="MenuClosedState">
                    <Storyboard>
                        <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="(UIElement.Visibility)" Storyboard.TargetName="MenuPanel">
                            <DiscreteObjectKeyFrame KeyTime="0">
                                <DiscreteObjectKeyFrame.Value>
                                    <Visibility>Collapsed</Visibility>
                                </DiscreteObjectKeyFrame.Value>
                            </DiscreteObjectKeyFrame>
                        </ObjectAnimationUsingKeyFrames>
                    </Storyboard>
                </VisualState>
                <VisualState x:Name="MenuOpenedState">
                    <Storyboard>
                        <DoubleAnimation Duration="0" To="0" Storyboard.TargetProperty="(UIElement.RenderTransform).(CompositeTransform.TranslateY)" Storyboard.TargetName="MenuPanel" d:IsOptimized="True"/>
                        <DoubleAnimation Duration="0" To="0" Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.Y)" Storyboard.TargetName="RootPanel" d:IsOptimized="True"/>
                    </Storyboard>
                </VisualState>
                <VisualState x:Name="MenuOpenedNoMenuState">
                    <Storyboard>
                        <DoubleAnimation Duration="0" To="0" Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.Y)" Storyboard.TargetName="RootPanel" d:IsOptimized="True"/>
                    </Storyboard>
                </VisualState>
                <VisualState x:Name="MenuOpenedNoButtonState">
                    <Storyboard>
                        <DoubleAnimation Duration="0" To="0" Storyboard.TargetProperty="(UIElement.RenderTransform).(CompositeTransform.TranslateY)" Storyboard.TargetName="Menu" d:IsOptimized="True"/>
                    </Storyboard>
                </VisualState>
            </VisualStateGroup>

        </VisualStateManager.VisualStateGroups>
        <Grid.RenderTransform>
            <TranslateTransform/>
        </Grid.RenderTransform>
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition MaxHeight="300"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <Grid x:Name="TransPanel" Background="Transparent" Grid.RowSpan="2" Tap="Menu_OnTap" Visibility="Collapsed"
              ManipulationStarted="TransPanel_OnManipulationStarted"
              ManipulationDelta="TransPanel_OnManipulationDelta"/>
        <Grid x:Name="MenuPanel" Grid.Row="1" Background="{Binding Background,ElementName=RootControl}" 
              Visibility="Collapsed" Margin="0,0,0,-1" VerticalAlignment="Bottom">
            <Grid.RenderTransform>
                <CompositeTransform TranslateY="300"/>
            </Grid.RenderTransform>
            <ScrollViewer x:Name="Menu" Background="#16000000" >
                <StackPanel x:Name="MenusItemsControl"    
                        Tap="Menu_OnTap" Margin="0,6"
                        toolkit:TiltEffect.IsTiltEnabled="True"/>
            </ScrollViewer>
        </Grid>
        <Grid Grid.Row="2" CacheMode="BitmapCache" Tap="Menu_OnTap"
              ManipulationDelta="Bar_OnManipulationDelta"
              x:Name="AppBarPanel"
              Background="{Binding Background,ElementName=RootControl}" toolkit:TiltEffect.IsTiltEnabled="False">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto" MinWidth="12"/>
            </Grid.ColumnDefinitions>
            <StackPanel  Grid.Column="0" Orientation="Horizontal" Background="#33000000" x:Name="LeftButtonsItemsControl" VerticalAlignment="Stretch" HorizontalAlignment="Left"/>
            <StackPanel Grid.Column="1" Orientation="Horizontal" x:Name="ButtonsItemsControl" VerticalAlignment="Stretch" HorizontalAlignment="Right" />
            <controls:ModernAppBarButton 
                x:Name="DisplayMenuButton"
Margin="{Binding Padding,ElementName=RootControl}"
                Visibility="Collapsed" Tap="Empty_Tap"
            Grid.Column="2" Click="DisplayMenu_Click"
            Content="&#57612;"/>
        </Grid>
    </Grid>
</UserControl>